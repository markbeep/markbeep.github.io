<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="Mark's Site"><title>3D Raycasting - Hello, I&rsquo;m Mark</title><link rel="shortcut icon" href=/m.ico><link rel=stylesheet href=/css/main.min.8022aa4b53ce57ff6f9cc4594360bfc15f2baeb5a018d0c68826f12da49a51e0.css integrity="sha256-gCKqS1POV/9vnMRZQ2C/wV8rrrWgGNDGiCbxLaSaUeA=" crossorigin=anonymous media=screen><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Didact+Gothic"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://markc.su/posts/raycasting/screen1.png"><meta name=twitter:title content="3D Raycasting"><meta name=twitter:description content="Becoming a Coding Train Fanboy&nbsp;¶ Lately I&rsquo;ve been binging a lot of YouTube again and for a while now I&rsquo;ve been recommended The Coding Train videos, but I&rsquo;ve never cared enough to open one of his 40min videos, until a week ago when I discovered how great his coding projects are. Upon watching the introduction of one of his approximating Pi videos I decided it would be fun to try and code the program, before watching the video."><meta property="og:title" content="3D Raycasting"><meta property="og:description" content="Becoming a Coding Train Fanboy&nbsp;¶ Lately I&rsquo;ve been binging a lot of YouTube again and for a while now I&rsquo;ve been recommended The Coding Train videos, but I&rsquo;ve never cared enough to open one of his 40min videos, until a week ago when I discovered how great his coding projects are. Upon watching the introduction of one of his approximating Pi videos I decided it would be fun to try and code the program, before watching the video."><meta property="og:type" content="article"><meta property="og:url" content="https://markc.su/posts/raycasting/"><meta property="og:image" content="https://markc.su/posts/raycasting/screen1.png"><meta property="og:image" content="https://markc.su/posts/raycasting/screen2.png"><meta property="og:image" content="https://markc.su/posts/raycasting/screen3.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-14T08:11:22+01:00"><meta property="article:modified_time" content="2022-03-14T08:11:22+01:00"><meta property="og:site_name" content="Hello, I'm Mark"><title>3D Raycasting</title></head><body><header class="wrap flex-container"><h1>3D Raycasting</h1></header><main class=wrap><div class=flex-container><aside role=complementary>Mon Mar 14, 2022 &#183; 1085 words<div class=tag-container><span class=tag><a href=/tags/visual/>visual</a></span>
<span class=tag><a href=/tags/programming/>programming</a></span>
<span class=tag><a href=/tags/c++/>c++</a></span></div></aside><hr><article role=article><h1 id=becoming-a-coding-train-fanboy class=anchor-link><a href=#becoming-a-coding-train-fanboy>Becoming a Coding Train Fanboy<span class=pilcrow>&nbsp;¶</span></a></h1><p>Lately I&rsquo;ve been binging a lot of YouTube again and for a while now I&rsquo;ve been recommended <em>The Coding Train</em> videos, but I&rsquo;ve never cared enough to open one of his 40min videos, until a week ago when I discovered how great his coding projects are. Upon watching the introduction of one of his <a href="https://www.youtube.com/watch?v=5cNnf_7e92Q">approximating Pi</a> videos I decided it would be fun to try and code the program, before watching the video. It was a fun little project and I can really recommend it.</p><p>Upon scouting around some of his other videos, I realized that his coding challenge videos all have a recurring theme: They are all really cool day/weekend projects! The first few minutes he talks about what the project will be about and he even explains it visually on his whiteboard. This is usually enough to get started in the project and is also how I created my first raycasting program. I&rsquo;d watch the intro of his video, then try to code it myself and if I was stuck I would catch up in his video. I found this video about <a href="https://www.youtube.com/watch?v=TOEi6T2mtHo">2D raycasting</a> and was intrigued enough to try it out. Once I got that done I also saw his <a href="https://www.youtube.com/watch?v=vYgIKn7iDH8">3D raycasting</a> video and decided to create that as well. That is also what this blogpost is about.</p><h1 id=getting-the-2d-raycasting-to-work class=anchor-link><a href=#getting-the-2d-raycasting-to-work>Getting the 2D Raycasting to work<span class=pilcrow>&nbsp;¶</span></a></h1><p>The first step was to get the base all nicely setup and get some simple raytracing setup in a 2D visual environment. For this visual environment I used <a href=https://www.sfml-dev.org/>SFML</a>. A really cool C++ multi-media library. It allows one to draw lines and squares, which is all I needed for this project. It being a C++ library allows me to write inefficient code, but still have the program run really quick. Aaaaaaannd C++ is just a cool language to use in general.</p><p>I started with a single ray that had a position and a direction. Then I worked on a function to find me the intersection of that ray and a single wall (if there was one). Thankfully this was really well documented in this <a href=https://en.wikipedia.org/wiki/Line%E2%80%93line_intersection#Given_two_points_on_each_line_segment>line-line intersection</a> Wikipedia article. The second step was to iterate over all the walls and find the intersection that is closest to the origin of the ray. This now allowed me to shoot a ray in any direction and find the first wall it hit.</p><p>Now I was able to create a player struct that had a position, a view direction and contained an array of rays:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>player</span> {
    sf<span style=color:#f92672>::</span>Vector2f pos;
    sf<span style=color:#f92672>::</span>Vector2f dir;
    sf<span style=color:#f92672>::</span>Vector2f<span style=color:#f92672>*</span> rays;
};
</code></pre></div><p><em><code>sf::Vector2f</code> is a 2-wide float vector from the SFML library.</em></p><p>At this step, I was able to create a circle of rays around the player and for each ray I checked the closest intersection of a wall. I sadly don&rsquo;t have a picture of this step. By reducing the degree range of the rays from 360° to 50° I was able to simulate a more realistic FOV (field of view). This then got me the effect visible in the below GIF (you&rsquo;ll notice there is some other shenanigans going on in that GIF, I already started on the 3D part there).</p><p><p style=text-align:center><img src=https://imgur.com/LkUAqtA.gif alt></p></p><h1 id=turning-2d-into-3d class=anchor-link><a href=#turning-2d-into-3d>Turning 2D into 3D<span class=pilcrow>&nbsp;¶</span></a></h1><p>Now we come to the interesting part. Here I made the 2D raycasting into something that looks 3D. This is actually fairly simple. If you&rsquo;ve been able to follow up to here, you&rsquo;ll be able to follow this 3D part no problem. This is also the part that makes my 2D lines look more like <a href=https://en.wikipedia.org/wiki/Wolfenstein_3D>Wolfenstein 3D</a>.</p><p>To get this 3D effect I was able to simply look at all my rays and check if they&rsquo;re touching any wall. If they are, we can get the distance to the point of contact and draw a thin rectangle with the height depending on the distance. If the distance is bigger, we create a smaller rectangle and if the distance is lower, we create a higher rectangle. This then gives off the effect of a 3D world where far things appear small and close things appear big.</p><h1 id=adding-colors class=anchor-link><a href=#adding-colors>Adding colors<span class=pilcrow>&nbsp;¶</span></a></h1><p>If all the walls are the same color, we don&rsquo;t really get a full 3D effect yet though. A simple way to make it look 3D is to have closer walls appear brighter and further ones darker. This also gives off an effect as if we&rsquo;d be holding a diffused light. This would also be fitting for a horror game.</p><p>Here is a screenshot of how that looked:<p style=text-align:center><img src=/posts/raycasting/screen1.png alt></p>The overlayed boxes and dot with lines coming around is how the map was set up at that point.</p><p>I then went further and added some colors to the ceiling and floor, instead of simply having them be completely black:<p style=text-align:center><img src=/posts/raycasting/screen2.png alt></p></p><p>Lastly I added a gradient to the floor and ceiling to make them also look as if it&rsquo;s getting further away. On top of that I finally added some more boxes to the map to make it a bit more interesting to run around in:<p style=text-align:center><img src=/posts/raycasting/screen3.png alt></p></p><h1 id=going-forward class=anchor-link><a href=#going-forward>Going forward<span class=pilcrow>&nbsp;¶</span></a></h1><p>This project could be continued in a lot of directions. I already thought about maybe bringing in enemies which could be simple sprites that constantly look at the player (makes drawing them easier) and adding a gun just like in Wolfenstein 3D. But that would be for another time.</p><p>Additionally, if you run the program on your own machine, you might notice that the movement and turning is really slow or really fast. That&rsquo;s because right now I simply update the screen with a while True loop, which depending on how fast your machine is makes moving around and turning faster or slower. When I was testing around different FOVs which resulted in a lot more rays being shot out, I also had to occasionally change up the movement speed so I was able to move around at a reasonable speed. Thinking back, this could have probably simply been fixed with some deltaTime variable that measures the time since the last iteration.</p><p>All in all, this is a project I can really recommend, as it sounds like a really daunting task at first (if you&rsquo;ve never done 3D), but as you go step by step you&rsquo;ll see how it all works and is really satisfying.</p><h1 id=source-code class=anchor-link><a href=#source-code>Source Code<span class=pilcrow>&nbsp;¶</span></a></h1><p>If you want to try it out, the source code is all <a href=https://github.com/markbeep/3D-Simple-Raycasting>over here</a>. Most of the files are simply boilerplate code that are used to run SFML on VSCode. The file with all the logic is <code>src/Main.cpp</code>.</p></div></article></div><nav role=navigation class="flex-container bottom-menu"><hr><p><script src=https://utteranc.es/client.js repo=markbeep/markbeep.github.io issue-term=pathname label=comments theme=dark-blue crossorigin=anonymous async></script><a href=/posts>back</a>
&#183;
<a href=/posts>posts</a>
&#183;
<a href=https://github.com/markbeep>github</a>
&#183;
<a href=/polyring>polyring</a>
&#183;
<a href=/about>who is mark?</a>
&#183;
<a href=/>main</a></p></nav></main><footer class="flex-container footer">Call me Sam, a theme for Hugo.</footer></body></html>